<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV SUITE v9.3</title>
    <style>
        /* ä¿æŒ v9 æš—å¤œæå…‰ UI ä¸å˜ */
        :root {
            --bg-color: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.7);
            --editor-bg: #0b1120;
            --text-main: #e2e8f0;
            --text-dim: #94a3b8;
            --accent-gradient: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            --border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(139, 92, 246, 0.15) 0px, transparent 50%);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
            font-size: 13px;
        }

        .app-container { display: flex; width: 100%; height: 100%; }

        /* å·¦ä¾§ */
        .sidebar {
            width: 360px;
            background: var(--panel-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: var(--border);
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        .brand-area { padding: 20px; border-bottom: var(--border); }
        .app-title { font-size: 18px; font-weight: 800; margin: 0; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .app-subtitle { font-size: 10px; color: var(--text-dim); margin-top: 4px; text-transform: uppercase; letter-spacing: 1px; }

        .scroll-content { flex: 1; overflow-y: auto; padding: 20px; }

        .control-group { margin-bottom: 24px; }
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .label-title { font-weight: 600; color: #fff; font-size: 12px; }

        input, textarea, select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 10px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
        }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #8b5cf6; background: rgba(0,0,0,0.5); }
        
        .tags-container { display: flex; flex-wrap: wrap; gap: 4px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; max-height: 100px; overflow-y: auto; }
        .tag { font-size: 10px; padding: 2px 6px; background: rgba(59, 130, 246, 0.2); color: #93c5fd; border-radius: 4px; }
        .tag.brand { background: rgba(139, 92, 246, 0.2); color: #c4b5fd; }

        .action-area { padding: 20px; background: rgba(15, 23, 42, 0.8); border-top: var(--border); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 13px; margin-bottom: 10px; transition: 0.2s; }
        .btn-primary { background: var(--accent-gradient); color: white; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); }
        .btn-secondary { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: var(--text-dim); }
        .btn-secondary:hover { border-color: rgba(255,255,255,0.4); color: white; }

        /* å³ä¾§ */
        .main-content { flex: 1; display: flex; flex-direction: column; background: rgba(0,0,0,0.2); }
        .editor-container { flex: 1; display: flex; gap: 1px; background: #1e293b; }
        .editor-pane { flex: 1; display: flex; flex-direction: column; background: var(--bg-color); }
        .pane-header { padding: 12px 20px; background: rgba(30, 41, 59, 0.5); border-bottom: var(--border); font-weight: 600; font-size: 12px; color: var(--text-dim); display: flex; justify-content: space-between; }
        .code-editor { flex: 1; background: var(--editor-bg); border: none; color: #cbd5e1; padding: 20px; font-family: monospace; font-size: 13px; line-height: 1.6; resize: none; outline: none; }
        .action-link { cursor: pointer; color: #3b82f6; }
    </style>
</head>
<body>

    <div class="app-container">
        <aside class="sidebar">
            <div class="brand-area">
                <h1 class="app-title">IPTV SUITE</h1>
                <div class="app-subtitle">v9.3 Minimalist</div>
            </div>

            <div class="scroll-content">
                <div class="control-group">
                    <div class="label-row"><span class="label-title">ğŸ“ æœ¬åœ°åŒ–</span></div>
                    <input type="text" id="myProv" value="" placeholder="è¾“å…¥çœä»½ (å¦‚: æµ™æ±Ÿ)">
                    <textarea id="myCity" style="margin-top:8px; height: 50px;" placeholder="å…³æ³¨çš„å¿å¸‚ (ç©ºæ ¼éš”å¼€)&#10;ä¾‹: é•¿æ²™ æµé˜³ å®ä¹¡"></textarea>
                </div>

                <div class="control-group">
                    <div class="label-row"><span class="label-title">âš™ï¸ EPG èŠ‚ç›®å•</span></div>
                    <select id="epgSelect" onchange="updateEpgInput()">
                        <option value="https://live.fanmingming.com/e.xml">èŒƒæ˜æ˜ EPG (æ¨è)</option>
                        <option value="http://epg.51zmt.com:8000/e.xml">51zmt EPG</option>
                        <option value="https://epg.112114.xyz/pp.xml">112114 EPG</option>
                    </select>
                    <input type="hidden" id="epgUrl" value="https://live.fanmingming.com/e.xml">
                    <div style="margin-top:5px; font-size:11px; color:#64748b;">* å·²è‡ªåŠ¨é…ç½®å°æ ‡ Logo åœ°å€</div>
                </div>

                <div class="control-group">
                    <div class="label-row"><span class="label-title">â›” å…³é”®è¯é»‘åå•</span></div>
                    <textarea id="blacklist" style="height:60px;">è´­ç‰©,ç†è´¢,æµ‹è¯•,è½®æ’­,æ¼”ç¤º,ç¤ºä¾‹,æŒ‡å—,å¯¼è§†,ç”Ÿæ´»èŒƒ,å®¶åº­å¤§å±å¹•,å–è¯,é‡æ¸©,ä»…ä¾›,å¤±æ•ˆ,æ›´å¤š</textarea>
                </div>

                <div class="control-group" style="opacity: 0.8;">
                    <div class="label-row"><span class="label-title">ğŸ“¡ å†…ç½®é¢‘é“åº“ (è‡ªåŠ¨è¯†åˆ«)</span></div>
                    <div class="tags-container" id="digitalPreview"></div>
                </div>
            </div>

            <div class="action-area">
                <button class="btn btn-primary" onclick="process()">âš¡ æ‰§è¡Œæ•´ç†</button>
                <button class="btn btn-secondary" onclick="downloadM3u()">ğŸ’¾ ä¸‹è½½ M3U</button>
                <div id="status" style="text-align:center; margin-top:10px; font-size:11px; color:#64748b;">å°±ç»ª</div>
            </div>
        </aside>

        <main class="main-content">
            <div class="editor-container">
                <div class="editor-pane">
                    <div class="pane-header"><span>ğŸ“¥ è¾“å…¥æº (TXT)</span><span class="action-link" onclick="document.getElementById('inputTxt').value=''">æ¸…ç©º</span></div>
                    <textarea id="inputTxt" class="code-editor" placeholder="åœ¨æ­¤ç²˜è´´..."></textarea>
                </div>
                <div class="editor-pane">
                    <div class="pane-header"><span>ğŸ“¤ ç»“æœ (M3U)</span><span class="action-link" onclick="copyResult()">å¤åˆ¶</span></div>
                    <textarea id="outputRes" class="code-editor" readonly placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                </div>
            </div>
        </main>
    </div>

    <script>
        // é…ç½®æ•°æ®
        const DIGITAL_BRANDS = ["CHC", "DOX", "NewTV", "iHOT", "SiTV", "IPTV", "å¤©å", "åŒ—å¹¿", "å½©äº¿", "æ˜Ÿå…ƒ", "æ±‚ç´¢", "é£äº‘", "ç¬¬ä¸€å‰§åœº", "æ€€æ—§å‰§åœº", "ä¸–ç•Œåœ°ç†", "å¤®å¹¿å¥åº·", "åŠ²çˆ†ä½“è‚²", "æé€Ÿæ±½è½¦", "å…¨çºªå®", "æˆ‘æ˜¯Kæ­Œç‹"];
        const DIGITAL_TITLES = ["é«˜å°”å¤«", "å°çƒ", "ç½‘çƒ", "è¶³çƒ", "èµ›è½¦", "æ±½æ‘©", "å…ˆé”‹ä¹’ç¾½", "å››æµ·é’“é±¼", "å¿«ä¹å‚é’“", "æ¬§æ´²è¶³çƒ", "åŠ¨æ„Ÿè‹±è¶…", "æ­¦æœ¯ä¸–ç•Œ", "ç”µç«å¤©å ‚", "è¶…çº§ç©å®¶", "ç«Gåœº", "ç‹è€…è£è€€", "ç¯å®‡ç”µå½±", "çƒ­é—¨å‰§åœº", "è°æˆ˜å‰§åœº", "æ˜Ÿå…‰é™¢çº¿", "æ¸¯å‰§é£äº‘", "äºšæ´²ç”µå½±", "ç²¾å½©å½±è§†", "å¤è£…å‰§åœº", "æ¬§ç¾ç”µå½±", "æ­¦ä¾ å‰§åœº", "é»‘è“ç”µå½±", "å¤§ç‰‡", "éƒ½å¸‚å‰§åœº", "æ¬¢ç¬‘å‰§åœº", "é‡‘ç‰Œå‰§åœº", "é‡æ¸©ç»å…¸", "æ¢¨å›­", "æˆæ›²", "å…µå™¨", "æ–‡ç‰©", "å›´æ£‹", "ç½®ä¸š", "å® ç‰©", "ä¹¦ç”»", "æ‘„å½±", "èŒ¶é¢‘é“", "ç¯çƒæ—…æ¸¸", "ç¾é£Ÿ", "é“å¦†", "æ—¶å°š", "åŠ¨æ¼«", "æ¸¸æˆ", "æ”¶è—å¤©ä¸‹", "å«ç”Ÿå¥åº·", "æ—©æœŸæ•™è‚²", "å¹¼å„¿æ•™è‚²", "ç•™å­¦ä¸–ç•Œ", "å›½å­¦", "è‹±è¯­æ•™å®¤", "è€å¹´ç¦", "æ³•å¾‹æœåŠ¡", "è¯åˆ¸æœåŠ¡", "æˆ¿äº§é¢‘é“", "ä¸­åç‰¹äº§", "å‘ç°ä¹‹æ—…", "ä¼˜ä¼˜å®è´", "å®å®å·´å£«", "æ•°ç æ—¶ä»£", "æ–°è§†è§‰", "è€æ•…äº‹", "ä¸­å­¦ç”Ÿ", "ä¹æ¸¸", "æ–°è§†è§‰", "ä¹¦æ³•", "é‡‘è‰²å­¦å ‚", "æ³•åˆ¶å¤©åœ°", "è´¢å¯Œå¤©ä¸‹"];
        const CITY_DB = {
            "åŒ—äº¬":"åŒ—äº¬é¢‘é“","ä¸Šæµ·":"ä¸Šæµ·é¢‘é“","å¤©æ´¥":"å¤©æ´¥é¢‘é“","é‡åº†":"é‡åº†é¢‘é“", "é•¿æ²™":"æ¹–å—çœå†…","æ ªæ´²":"æ¹–å—çœå†…","æ¹˜æ½­":"æ¹–å—çœå†…","è¡¡é˜³":"æ¹–å—çœå†…","é‚µé˜³":"æ¹–å—çœå†…","å²³é˜³":"æ¹–å—çœå†…","å¸¸å¾·":"æ¹–å—çœå†…","å¼ å®¶ç•Œ":"æ¹–å—çœå†…","ç›Šé˜³":"æ¹–å—çœå†…","éƒ´å·":"æ¹–å—çœå†…","æ°¸å·":"æ¹–å—çœå†…","æ€€åŒ–":"æ¹–å—çœå†…","å¨„åº•":"æ¹–å—çœå†…","æ¹˜è¥¿":"æ¹–å—çœå†…", "å¹¿å·":"å¹¿ä¸œçœå†…","æ·±åœ³":"å¹¿ä¸œçœå†…","ç æµ·":"å¹¿ä¸œçœå†…","æ±•å¤´":"å¹¿ä¸œçœå†…","ä½›å±±":"å¹¿ä¸œçœå†…","éŸ¶å…³":"å¹¿ä¸œçœå†…","æ¹›æ±Ÿ":"å¹¿ä¸œçœå†…","è‚‡åº†":"å¹¿ä¸œçœå†…","æ±Ÿé—¨":"å¹¿ä¸œçœå†…","èŒ‚å":"å¹¿ä¸œçœå†…","æƒ å·":"å¹¿ä¸œçœå†…","æ¢…å·":"å¹¿ä¸œçœå†…","æ±•å°¾":"å¹¿ä¸œçœå†…","æ²³æº":"å¹¿ä¸œçœå†…","é˜³æ±Ÿ":"å¹¿ä¸œçœå†…","æ¸…è¿œ":"å¹¿ä¸œçœå†…","ä¸œè":"å¹¿ä¸œçœå†…","ä¸­å±±":"å¹¿ä¸œçœå†…","æ½®å·":"å¹¿ä¸œçœå†…","æ­é˜³":"å¹¿ä¸œçœå†…","äº‘æµ®":"å¹¿ä¸œçœå†…", "æ­å·":"æµ™æ±Ÿçœå†…","å®æ³¢":"æµ™æ±Ÿçœå†…","æ¸©å·":"æµ™æ±Ÿçœå†…","å˜‰å…´":"æµ™æ±Ÿçœå†…","æ¹–å·":"æµ™æ±Ÿçœå†…","ç»å…´":"æµ™æ±Ÿçœå†…","é‡‘å":"æµ™æ±Ÿçœå†…","è¡¢å·":"æµ™æ±Ÿçœå†…","èˆŸå±±":"æµ™æ±Ÿçœå†…","å°å·":"æµ™æ±Ÿçœå†…","ä¸½æ°´":"æµ™æ±Ÿçœå†…", "å—äº¬":"æ±Ÿè‹çœå†…","æ— é”¡":"æ±Ÿè‹çœå†…","å¾å·":"æ±Ÿè‹çœå†…","å¸¸å·":"æ±Ÿè‹çœå†…","è‹å·":"æ±Ÿè‹çœå†…","å—é€š":"æ±Ÿè‹çœå†…","è¿äº‘æ¸¯":"æ±Ÿè‹çœå†…","æ·®å®‰":"æ±Ÿè‹çœå†…","ç›åŸ":"æ±Ÿè‹çœå†…","æ‰¬å·":"æ±Ÿè‹çœå†…","é•‡æ±Ÿ":"æ±Ÿè‹çœå†…","æ³°å·":"æ±Ÿè‹çœå†…","å®¿è¿":"æ±Ÿè‹çœå†…", "æµå—":"å±±ä¸œçœå†…","é’å²›":"å±±ä¸œçœå†…","æ·„åš":"å±±ä¸œçœå†…","æ£åº„":"å±±ä¸œçœå†…","ä¸œè¥":"å±±ä¸œçœå†…","çƒŸå°":"å±±ä¸œçœå†…","æ½åŠ":"å±±ä¸œçœå†…","æµå®":"å±±ä¸œçœå†…","æ³°å®‰":"å±±ä¸œçœå†…","å¨æµ·":"å±±ä¸œçœå†…","æ—¥ç…§":"å±±ä¸œçœå†…","ä¸´æ²‚":"å±±ä¸œçœå†…","å¾·å·":"å±±ä¸œçœå†…","èŠåŸ":"å±±ä¸œçœå†…","æ»¨å·":"å±±ä¸œçœå†…","èæ³½":"å±±ä¸œçœå†…", "æ­¦æ±‰":"æ¹–åŒ—çœå†…","é»„çŸ³":"æ¹–åŒ—çœå†…","åå °":"æ¹–åŒ—çœå†…","å®œæ˜Œ":"æ¹–åŒ—çœå†…","è¥„é˜³":"æ¹–åŒ—çœå†…","é„‚å·":"æ¹–åŒ—çœå†…","è†é—¨":"æ¹–åŒ—çœå†…","å­æ„Ÿ":"æ¹–åŒ—çœå†…","è†å·":"æ¹–åŒ—çœå†…","é»„å†ˆ":"æ¹–åŒ—çœå†…","å’¸å®":"æ¹–åŒ—çœå†…","éšå·":"æ¹–åŒ—çœå†…","æ©æ–½":"æ¹–åŒ—çœå†…", "éƒ‘å·":"æ²³å—çœå†…","å¼€å°":"æ²³å—çœå†…","æ´›é˜³":"æ²³å—çœå†…","å¹³é¡¶å±±":"æ²³å—çœå†…","å®‰é˜³":"æ²³å—çœå†…","é¹¤å£":"æ²³å—çœå†…","æ–°ä¹¡":"æ²³å—çœå†…","ç„¦ä½œ":"æ²³å—çœå†…","æ¿®é˜³":"æ²³å—çœå†…","è®¸æ˜Œ":"æ²³å—çœå†…","æ¼¯æ²³":"æ²³å—çœå†…","ä¸‰é—¨å³¡":"æ²³å—çœå†…","å—é˜³":"æ²³å—çœå†…","å•†ä¸˜":"æ²³å—çœå†…","ä¿¡é˜³":"æ²³å—çœå†…","å‘¨å£":"æ²³å—çœå†…","é©»é©¬åº—":"æ²³å—çœå†…", "çŸ³å®¶åº„":"æ²³åŒ—çœå†…","å”å±±":"æ²³åŒ—çœå†…","ç§¦çš‡å²›":"æ²³åŒ—çœå†…","é‚¯éƒ¸":"æ²³åŒ—çœå†…","é‚¢å°":"æ²³åŒ—çœå†…","ä¿å®š":"æ²³åŒ—çœå†…","å¼ å®¶å£":"æ²³åŒ—çœå†…","æ‰¿å¾·":"æ²³åŒ—çœå†…","æ²§å·":"æ²³åŒ—çœå†…","å»ŠåŠ":"æ²³åŒ—çœå†…","è¡¡æ°´":"æ²³åŒ—çœå†…", "å¤ªåŸ":"å±±è¥¿çœå†…","å¤§åŒ":"å±±è¥¿çœå†…","é˜³æ³‰":"å±±è¥¿çœå†…","é•¿æ²»":"å±±è¥¿çœå†…","æ™‹åŸ":"å±±è¥¿çœå†…","æœ”å·":"å±±è¥¿çœå†…","æ™‹ä¸­":"å±±è¥¿çœå†…","è¿åŸ":"å±±è¥¿çœå†…","å¿»å·":"å±±è¥¿çœå†…","ä¸´æ±¾":"å±±è¥¿çœå†…","å•æ¢":"å±±è¥¿çœå†…", "æ²ˆé˜³":"è¾½å®çœå†…","å¤§è¿":"è¾½å®çœå†…","éå±±":"è¾½å®çœå†…","æŠšé¡º":"è¾½å®çœå†…","æœ¬æºª":"è¾½å®çœå†…","ä¸¹ä¸œ":"è¾½å®çœå†…","é”¦å·":"è¾½å®çœå†…","è¥å£":"è¾½å®çœå†…","é˜œæ–°":"è¾½å®çœå†…","è¾½é˜³":"è¾½å®çœå†…","ç›˜é”¦":"è¾½å®çœå†…","é“å²­":"è¾½å®çœå†…","æœé˜³":"è¾½å®çœå†…","è‘«èŠ¦å²›":"è¾½å®çœå†…", "é•¿æ˜¥":"å‰æ—çœå†…","å‰æ—":"å‰æ—çœå†…","å››å¹³":"å‰æ—çœå†…","è¾½æº":"å‰æ—çœå†…","é€šåŒ–":"å‰æ—çœå†…","ç™½å±±":"å‰æ—çœå†…","æ¾åŸ":"å‰æ—çœå†…","ç™½åŸ":"å‰æ—çœå†…","å»¶è¾¹":"å‰æ—çœå†…", "å“ˆå°”æ»¨":"é»‘é¾™æ±Ÿçœå†…","é½é½å“ˆå°”":"é»‘é¾™æ±Ÿçœå†…","é¸¡è¥¿":"é»‘é¾™æ±Ÿçœå†…","é¹¤å²—":"é»‘é¾™æ±Ÿçœå†…","åŒé¸­å±±":"é»‘é¾™æ±Ÿçœå†…","å¤§åº†":"é»‘é¾™æ±Ÿçœå†…","ä¼Šæ˜¥":"é»‘é¾™æ±Ÿçœå†…","ä½³æœ¨æ–¯":"é»‘é¾™æ±Ÿçœå†…","ä¸ƒå°æ²³":"é»‘é¾™æ±Ÿçœå†…","ç‰¡ä¸¹æ±Ÿ":"é»‘é¾™æ±Ÿçœå†…","é»‘æ²³":"é»‘é¾™æ±Ÿçœå†…","ç»¥åŒ–":"é»‘é¾™æ±Ÿçœå†…","å¤§å…´å®‰å²­":"é»‘é¾™æ±Ÿçœå†…", "åˆè‚¥":"å®‰å¾½çœå†…","èŠœæ¹–":"å®‰å¾½çœå†…","èšŒåŸ ":"å®‰å¾½çœå†…","æ·®å—":"å®‰å¾½çœå†…","é©¬éå±±":"å®‰å¾½çœå†…","æ·®åŒ—":"å®‰å¾½çœå†…","é“œé™µ":"å®‰å¾½çœå†…","å®‰åº†":"å®‰å¾½çœå†…","é»„å±±":"å®‰å¾½çœå†…","æ»å·":"å®‰å¾½çœå†…","é˜œé˜³":"å®‰å¾½çœå†…","å®¿å·":"å®‰å¾½çœå†…","å…­å®‰":"å®‰å¾½çœå†…","äº³å·":"å®‰å¾½çœå†…","æ± å·":"å®‰å¾½çœå†…","å®£åŸ":"å®‰å¾½çœå†…", "ç¦å·":"ç¦å»ºçœå†…","å¦é—¨":"ç¦å»ºçœå†…","è†ç”°":"ç¦å»ºçœå†…","ä¸‰æ˜":"ç¦å»ºçœå†…","æ³‰å·":"ç¦å»ºçœå†…","æ¼³å·":"ç¦å»ºçœå†…","å—å¹³":"ç¦å»ºçœå†…","é¾™å²©":"ç¦å»ºçœå†…","å®å¾·":"ç¦å»ºçœå†…", "å—æ˜Œ":"æ±Ÿè¥¿çœå†…","æ™¯å¾·é•‡":"æ±Ÿè¥¿çœå†…","èä¹¡":"æ±Ÿè¥¿çœå†…","ä¹æ±Ÿ":"æ±Ÿè¥¿çœå†…","æ–°ä½™":"æ±Ÿè¥¿çœå†…","é¹°æ½­":"æ±Ÿè¥¿çœå†…","èµ£å·":"æ±Ÿè¥¿çœå†…","å‰å®‰":"æ±Ÿè¥¿çœå†…","å®œæ˜¥":"æ±Ÿè¥¿çœå†…","æŠšå·":"æ±Ÿè¥¿çœå†…","ä¸Šé¥¶":"æ±Ÿè¥¿çœå†…", "æˆéƒ½":"å››å·çœå†…","è‡ªè´¡":"å››å·çœå†…","æ”€æèŠ±":"å››å·çœå†…","æ³¸å·":"å››å·çœå†…","å¾·é˜³":"å››å·çœå†…","ç»µé˜³":"å››å·çœå†…","å¹¿å…ƒ":"å››å·çœå†…","é‚å®":"å››å·çœå†…","å†…æ±Ÿ":"å››å·çœå†…","ä¹å±±":"å››å·çœå†…","å—å……":"å››å·çœå†…","çœ‰å±±":"å››å·çœå†…","å®œå®¾":"å››å·çœå†…","å¹¿å®‰":"å››å·çœå†…","è¾¾å·":"å››å·çœå†…","é›…å®‰":"å››å·çœå†…","å·´ä¸­":"å››å·çœå†…","èµ„é˜³":"å››å·çœå†…","é˜¿å":"å››å·çœå†…","ç”˜å­œ":"å››å·çœå†…","å‡‰å±±":"å››å·çœå†…", "è´µé˜³":"è´µå·çœå†…","å…­ç›˜æ°´":"è´µå·çœå†…","éµä¹‰":"è´µå·çœå†…","å®‰é¡º":"è´µå·çœå†…","æ¯•èŠ‚":"è´µå·çœå†…","é“œä»":"è´µå·çœå†…","é»”è¥¿å—":"è´µå·çœå†…","é»”ä¸œå—":"è´µå·çœå†…","é»”å—":"è´µå·çœå†…", "æ˜†æ˜":"äº‘å—çœå†…","æ›²é–":"äº‘å—çœå†…","ç‰æºª":"äº‘å—çœå†…","ä¿å±±":"äº‘å—çœå†…","æ˜­é€š":"äº‘å—çœå†…","ä¸½æ±Ÿ":"äº‘å—çœå†…","æ™®æ´±":"äº‘å—çœå†…","ä¸´æ²§":"äº‘å—çœå†…","æ¥šé›„":"äº‘å—çœå†…","çº¢æ²³":"äº‘å—çœå†…","æ–‡å±±":"äº‘å—çœå†…","è¥¿åŒç‰ˆçº³":"äº‘å—çœå†…","å¤§ç†":"äº‘å—çœå†…","å¾·å®":"äº‘å—çœå†…","æ€’æ±Ÿ":"äº‘å—çœå†…","è¿ªåº†":"äº‘å—çœå†…", "è¥¿å®‰":"é™•è¥¿çœå†…","é“œå·":"é™•è¥¿çœå†…","å®é¸¡":"é™•è¥¿çœå†…","å’¸é˜³":"é™•è¥¿çœå†…","æ¸­å—":"é™•è¥¿çœå†…","å»¶å®‰":"é™•è¥¿çœå†…","æ±‰ä¸­":"é™•è¥¿çœå†…","æ¦†æ—":"é™•è¥¿çœå†…","å®‰åº·":"é™•è¥¿çœå†…","å•†æ´›":"é™•è¥¿çœå†…", "å…°å·":"ç”˜è‚ƒçœå†…","å˜‰å³ªå…³":"ç”˜è‚ƒçœå†…","é‡‘æ˜Œ":"ç”˜è‚ƒçœå†…","ç™½é“¶":"ç”˜è‚ƒçœå†…","å¤©æ°´":"ç”˜è‚ƒçœå†…","æ­¦å¨":"ç”˜è‚ƒçœå†…","å¼ æ–":"ç”˜è‚ƒçœå†…","å¹³å‡‰":"ç”˜è‚ƒçœå†…","é…’æ³‰":"ç”˜è‚ƒçœå†…","åº†é˜³":"ç”˜è‚ƒçœå†…","å®šè¥¿":"ç”˜è‚ƒçœå†…","é™‡å—":"ç”˜è‚ƒçœå†…","ä¸´å¤":"ç”˜è‚ƒçœå†…","ç”˜å—":"ç”˜è‚ƒçœå†…", "è¥¿å®":"é’æµ·çœå†…","æµ·ä¸œ":"é’æµ·çœå†…","æµ·åŒ—":"é’æµ·çœå†…","é»„å—":"é’æµ·çœå†…","æµ·å—":"é’æµ·çœå†…","æœæ´›":"é’æµ·çœå†…","ç‰æ ‘":"é’æµ·çœå†…","æµ·è¥¿":"é’æµ·çœå†…", "å—å®":"å¹¿è¥¿çœå†…","æŸ³å·":"å¹¿è¥¿çœå†…","æ¡‚æ—":"å¹¿è¥¿çœå†…","æ¢§å·":"å¹¿è¥¿çœå†…","åŒ—æµ·":"å¹¿è¥¿çœå†…","é˜²åŸæ¸¯":"å¹¿è¥¿çœå†…","é’¦å·":"å¹¿è¥¿çœå†…","è´µæ¸¯":"å¹¿è¥¿çœå†…","ç‰æ—":"å¹¿è¥¿çœå†…","ç™¾è‰²":"å¹¿è¥¿çœå†…","è´ºå·":"å¹¿è¥¿çœå†…","æ²³æ± ":"å¹¿è¥¿çœå†…","æ¥å®¾":"å¹¿è¥¿çœå†…","å´‡å·¦":"å¹¿è¥¿çœå†…", "æµ·å£":"æµ·å—çœå†…","ä¸‰äºš":"æµ·å—çœå†…","ä¸‰æ²™":"æµ·å—çœå†…","å„‹å·":"æµ·å—çœå†…", "å‘¼å’Œæµ©ç‰¹":"å†…è’™å¤çœå†…","åŒ…å¤´":"å†…è’™å¤çœå†…","ä¹Œæµ·":"å†…è’™å¤çœå†…","èµ¤å³°":"å†…è’™å¤çœå†…","é€šè¾½":"å†…è’™å¤çœå†…","é„‚å°”å¤šæ–¯":"å†…è’™å¤çœå†…","å‘¼ä¼¦è´å°”":"å†…è’™å¤çœå†…","å·´å½¦æ·–å°”":"å†…è’™å¤çœå†…","ä¹Œå…°å¯Ÿå¸ƒ":"å†…è’™å¤çœå†…","å…´å®‰ç›Ÿ":"å†…è’™å¤çœå†…","é”¡æ—éƒ­å‹’":"å†…è’™å¤çœå†…","é˜¿æ‹‰å–„":"å†…è’™å¤çœå†…", "é“¶å·":"å®å¤çœå†…","çŸ³å˜´å±±":"å®å¤çœå†…","å´å¿ ":"å®å¤çœå†…","å›ºåŸ":"å®å¤çœå†…","ä¸­å«":"å®å¤çœå†…", "ä¹Œé²æœ¨é½":"æ–°ç–†çœå†…","å…‹æ‹‰ç›ä¾":"æ–°ç–†çœå†…","åé²ç•ª":"æ–°ç–†çœå†…","å“ˆå¯†":"æ–°ç–†çœå†…","æ˜Œå‰":"æ–°ç–†çœå†…","åšå°”å¡”æ‹‰":"æ–°ç–†çœå†…","å·´éŸ³éƒ­æ¥":"æ–°ç–†çœå†…","é˜¿å…‹è‹":"æ–°ç–†çœå†…","å…‹å­œå‹’è‹":"æ–°ç–†çœå†…","å–€ä»€":"æ–°ç–†çœå†…","å’Œç”°":"æ–°ç–†çœå†…","ä¼ŠçŠ":"æ–°ç–†çœå†…","å¡”åŸ":"æ–°ç–†çœå†…","é˜¿å‹’æ³°":"æ–°ç–†çœå†…", "æ‹‰è¨":"è¥¿è—çœå†…","æ—¥å–€åˆ™":"è¥¿è—çœå†…","æ˜Œéƒ½":"è¥¿è—çœå†…","æ—èŠ":"è¥¿è—çœå†…","å±±å—":"è¥¿è—çœå†…","é‚£æ›²":"è¥¿è—çœå†…","é˜¿é‡Œ":"è¥¿è—çœå†…"
        };

        window.onload = function() {
            document.getElementById('digitalPreview').innerHTML = DIGITAL_BRANDS.map(b=>`<span class="tag brand">${b}</span>`).join('') + DIGITAL_TITLES.map(t=>`<span class="tag">${t}</span>`).join('');
        };

        function updateEpgInput() {
            document.getElementById('epgUrl').value = document.getElementById('epgSelect').value;
        }

        function process() {
            const input = document.getElementById('inputTxt').value;
            const myProv = document.getElementById('myProv').value.trim().replace("çœ","");
            const myCities = document.getElementById('myCity').value.split(/[\s,]+/).filter(s=>s);
            const blacklist = document.getElementById('blacklist').value.split(/[,ï¼Œ\n]/).map(s=>s.trim()).filter(s=>s);
            const epgUrl = document.getElementById('epgUrl').value;
            
            // ğŸŸ¥ éšè—çš„é€»è¾‘ï¼šé»˜è®¤å…¨å¼€å¯åˆå¹¶
            const mergeOuter = true; 
            const mergeDistrict = true;
            // ğŸŸ¥ éšè—çš„é€»è¾‘ï¼šé»˜è®¤ Logo åœ°å€
            const logoBase = "https://live.fanmingming.com/tv/";

            const MY_PROV_GROUP = myProv ? (myProv + "çœå†…") : "æœ¬åœ°é¢‘é“";
            const grouped = new Map();
            const seen = new Set();
            let count = 0;

            input.split('\n').forEach(line => {
                line = line.trim();
                if(!line || line.includes('#genre#')) return;
                const parts = line.split(/,|ï¼Œ/);
                if(parts.length < 2) return;
                
                let name = parts[0].trim();
                let url = parts[1].trim();

                if(blacklist.some(k => name.includes(k))) return;

                // ç§»é™¤å¸¸è§„æ¸…æ™°åº¦æ ‡è¯†ï¼Œä¿ç•™é¢‘é“å
                let cleanName = name.replace(/\[.*?\]/g, '').replace(/(HD|FHD|HEVC)/ig, '').trim();
                let group = "å…¶ä»–é¢‘é“";
                let matched = false;

                // =========== 0. æ–°å¢ï¼š4K/8K è¶…æ¸…æ£€æµ‹ (ä¼˜å…ˆçº§æœ€é«˜) ===========
                if (cleanName.match(/4K|8K/i)) {
                    group = "4Kè¶…æ¸…é¢‘é“";
                    matched = true;
                }

                // 1. æ•°å­—ä»˜è´¹
                if (!matched) {
                    for (let brand of DIGITAL_BRANDS) if (cleanName.toUpperCase().includes(brand.toUpperCase())) { group = "æ•°å­—ä»˜è´¹"; matched = true; break; }
                    if (!matched) for (let title of DIGITAL_TITLES) if (cleanName.includes(title)) { group = "æ•°å­—ä»˜è´¹"; matched = true; break; }
                }

                // 2. å¤®è§†/å«è§†
                if (!matched) {
                    if (cleanName.match(/CCTV|CGTN/i)) { group = "å¤®è§†é¢‘é“"; matched = true; }
                    else if (cleanName.includes("å«è§†")) { group = "å«è§†é¢‘é“"; matched = true; }
                    else if (cleanName.match(/å‡¤å‡°|TVB|ç¿¡ç¿ |æ˜ç |æ¾³è§†/)) { group = "æ¸¯æ¾³å°"; matched = true; }
                }

                // 3. çœå¸‚å®šä½
                if (!matched) {
                    if (myCities.some(c => cleanName.includes(c))) { group = MY_PROV_GROUP; matched = true; }
                    else if (myProv && cleanName.includes(myProv)) { group = MY_PROV_GROUP; matched = true; }
                    else {
                        for (let city in CITY_DB) {
                            if (cleanName.includes(city)) {
                                const provGroup = CITY_DB[city];
                                if (provGroup.includes(myProv)) { 
                                    group = MY_PROV_GROUP; 
                                } else { 
                                    group = mergeOuter ? "å…¶ä»–é¢‘é“" : "å¤–çœé¢‘é“"; 
                                }
                                matched = true;
                                break;
                            }
                        }
                    }
                }

                // 4. åŒºå¿/åœ°æ–¹å°
                if (!matched) {
                    if (cleanName.match(/èåª’|å°|ç»¼åˆ|å…¬å…±|æ–‡æ—…|ç§‘æ•™|ç”Ÿæ´»|æ•™è‚²|æ°‘ç”Ÿ/)) {
                        group = mergeDistrict ? "å…¶ä»–é¢‘é“" : "åŒºå¿åœ°æ–¹";
                    }
                }

                if (seen.has(url)) return;
                seen.add(url);

                if (!grouped.has(group)) grouped.set(group, []);
                let logo = logoBase.endsWith('/') ? `${logoBase}${cleanName}.png` : `${logoBase}/${cleanName}.png`;
                grouped.get(group).push({name: cleanName, url, logo});
                count++;
            });

            // è¾“å‡º - åœ¨è¿™é‡Œå°† "4Kè¶…æ¸…é¢‘é“" åŠ å…¥æ’åº
            let result = `#EXTM3U x-tvg-url="${epgUrl}"\n`;
            
            // =========== æ›´æ–°æ’åºåˆ—è¡¨ ===========
            const order = [MY_PROV_GROUP, "4Kè¶…æ¸…é¢‘é“", "å¤®è§†é¢‘é“", "å«è§†é¢‘é“", "æ•°å­—ä»˜è´¹", "æ¸¯æ¾³å°", "åŒºå¿åœ°æ–¹", "å¤–çœé¢‘é“", "å…¶ä»–é¢‘é“"];
            
            const allGroups = [...order];
            for (let g of grouped.keys()) if(!allGroups.includes(g)) allGroups.push(g);

            allGroups.forEach(g => {
                if(grouped.has(g)) {
                    const list = grouped.get(g);
                    if(list.length > 0) {
                        result += `\n// ------ ${g} ------\n`; // å¯é€‰ï¼šåŠ ä¸Šæ³¨é‡Šåˆ†éš”æ–¹ä¾¿çœ‹
                        list.forEach(item => {
                            result += `#EXTINF:-1 group-title="${g}" tvg-name="${item.name}" tvg-logo="${item.logo}",${item.name}\n${item.url}\n`;
                        });
                    }
                }
            });

            document.getElementById('outputRes').value = result;
            document.getElementById('status').innerText = `âœ… æ•´ç†å®Œæˆ | é¢‘é“æ•°: ${count}`;
        }

        function copyResult() {
            document.getElementById('outputRes').select();
            document.execCommand('copy');
            document.getElementById('status').innerText = "å·²å¤åˆ¶";
        }
        function downloadM3u() {
            const content = document.getElementById('outputRes').value;
            const a = document.createElement("a");
            a.href = URL.createObjectURL(new Blob([content], {type: "text/plain"}));
            a.download = "playlist.m3u";
            a.click();
        }
    </script>
</body>
</html>
